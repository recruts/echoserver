spec:
databases:
    - cluster_name: echoserver
      db_name: db
      db_user: db
      engine: PG
      name: db
      num_nodes: 1
      production: true
      size: basic-xs
      version: "12"
#  jobs:
#    - name: create-databases
#      image:
#        registry_type: DOCKER_HUB
#        repository: postgres
#        tag: "12"
#      envs:
#        - key: POSTGRES_HOSTNAME
#          value: "${db.HOSTNAME}"
#        - key: POSTGRES_PORT
#          value: "${db.PORT}"
#        - key: POSTGRES_USER
#          value: "${db.USERNAME}"
#        - key: PGPASSWORD
#          value: "${db.PASSWORD}"
#      run_command: psql -c "CREATE DATABASE db1;"
  alerts:
    - rule: DEPLOYMENT_FAILED
    - rule: DOMAIN_FAILED
  ingress:
    rules:
      - component:
          name: backend
        match:
          path:
            prefix: /api
      - component:
          name: frontend
        match:
          path:
            prefix: /
  name: echoserver
  region: fra
  services:
    - name: backend
      dockerfile_path: Dockerfile
      git:
        branch: master
        repo_clone_url: https://github.com/recruts/echoserver.git
      http_port: 8080
      instance_count: 1
      instance_size_slug: basic-xxs
    - name: frontend
      dockerfile_path: Dockerfile
      git:
        branch: master
        repo_clone_url: https://github.com/recruts/frontend.git
      http_port: 80
      instance_count: 1
      instance_size_slug: basic-xxs

  workers:
    - name: postgres
      image:
        registry_type: DOCKER_HUB
        repository: postgres
        tag: "12"
      envs:
        - key: POSTGRES_HOSTNAME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          value: "${db.PORT}"
        - key: POSTGRES_USER
          value: "${db.USERNAME}"
        - key: PGPASSWORD
          value: "${db.PASSWORD}"

