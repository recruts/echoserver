spec:
  databases:
    - engine: PG
      name: db
      num_nodes: 1
      size: db-s-dev-database
      version: "12"
  jobs:
    - name: create-databases
      image:
        registry_type: DOCKER_HUB
        registry: docker.io
        repository: postgres
        tag: "12"
      envs:
        - key: DATABASE_URL
          value: "${db.DATABASE_URL}"
      run_command: psql -c "CREATE DATABASE db1;"
  alerts:
    - rule: DEPLOYMENT_FAILED
    - rule: DOMAIN_FAILED
  ingress:
    rules:
      - component:
          name: backend
        match:
          path:
            prefix: /api
      - component:
          name: frontend
        match:
          path:
            prefix: /
#      - component:
#          name: postgres
#        match:
#          path:
#            prefix: /p
  name: echoserver
  region: fra
  services:
    - name: backend
      dockerfile_path: Dockerfile
      git:
        branch: master
        repo_clone_url: https://github.com/recruts/echoserver.git
      http_port: 8080
      instance_count: 1
      instance_size_slug: basic-xxs
    - name: frontend
      dockerfile_path: Dockerfile
      git:
        branch: master
        repo_clone_url: https://github.com/recruts/frontend.git
      http_port: 80
      instance_count: 1
      instance_size_slug: basic-xxs

  workers:
    - name: postgres
      image:
        registry_type: DOCKER_HUB
        registry: docker.io
        repository: postgres
        tag: "12"
      envs:
        - key: DATABASE_URL
          value: "${db.DATABASE_URL}"

