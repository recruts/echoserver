#${APP_DOMAIN}
spec:
  databases:
    - engine: PG
      name: db
      num_nodes: 1
      size: db-s-dev-database
      version: "12"
  jobs:
    image:
      registry: postgres
      tag: 12
    envs:
      - key: DATABASE_URL
        value: "${db.DATABASE_URL}"
    run_command:
      - psql -c "CREATE DATABASE db1;"
      - psql -c "CREATE DATABASE db2;"
      - psql -c "CREATE DATABASE db3;"
  alerts:
    - rule: DEPLOYMENT_FAILED
    - rule: DOMAIN_FAILED
  ingress:
    rules:
      - component:
          name: backend
        match:
          path:
            prefix: /api
      - component:
          name: frontend
        match:
          path:
            prefix: /
  name: echoserver
  region: fra
  services:
    - name: backend
      dockerfile_path: Dockerfile
      git:
        branch: master
        repo_clone_url: https://github.com/recruts/echoserver.git
      http_port: 8080
      instance_count: 1
      instance_size_slug: basic-xxs
    - name: frontend
      dockerfile_path: Dockerfile
      git:
        branch: master
        repo_clone_url: https://github.com/recruts/frontend.git
      http_port: 80
      instance_count: 1
      instance_size_slug: basic-xxs
    - name: postgres
      image:
        registry: postgres
        tag: 12
      envs:
        - key: DATABASE_URL
          value: "${db.DATABASE_URL}"

